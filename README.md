## Traffic-Light
Задание по летней практике 2025

# Сглаживание значения сигнала светофора

**Задание:** Имеется набор значений, которые соответствуют распознанным с помощью
нейросети сигналам светофора в течение определённого промежутка времени. 

Значения дискретны: 
* 0 - распознать сигнал не удалось ввиду помех или загороженного посторонним
объектом светофора, 
* 1 - красный свет, 
* 2 - зелёный,
* 3 - жёлтый, 
* 4 - зеленая стрелка влево, 
* 5 - зеленая стрелка вправо,
* 6 - прямо, 
* 7 - назад, 
* 8 - непрерывный сигнал,
* 9 - мигающий сигнал. 



Светофор желательно рассматривать секционный,
с зелёной стрелкой влево/вправо помимо основных трёх цветов. 

Необходимо разработать алгоритм сглаживания такого сигнала, чтобы кратковременно
провляющиеся помехи (например, пешеход прошёл между светофором и
камерой) в итоговом наборе значений не отображались, т.е. при отсутствии
в течение короткого времени сигнала мы всё равно какое-то время "помним"
предыдущее значение.

--- 
# Support

**Python 3.9.13**

---
# Instal
**Описание зависимостей**

pandas - библиотека для обработки и анализа табличных данных (CSV)

```bush
pip install pandas
```
---

# Usage

Usage: traffic-lights-smoothing.py file.csv [--plot] [--print_csv | --print_human | --noprint]

file.csv: traffic light data (файл с данными, например classified_tls.csv)

**Options:**

* --plot: рисует графики

* --print_csv: выводит результат в формате csv

* --print_human: выводит результат в формате удобный для чтения человеком (по умолчанию)

* --noprint: не выводит результат

---

# Метод: Взвешенный временной консенсус с фильтрацией по уверенности
**Пошаговый алгоритм:**

1. Определение временного окна (Delta T):

Задаем симметричное временное окно вокруг момента t. Например, если Delta T = 2 секунды, мы будете рассматривать все записи из интервала [t - 1, t + 1].

Размер Delta T является настраиваемым параметром:

* Малое Delta T: Алгоритм будет более чувствителен к быстрым изменениям и новым данным.
* Большое Delta T: Алгоритм будет более сглаженным, устойчивым к шуму, но может медленнее реагировать на реальные переключения светофора.

2. Фильтрация по порогу уверенности:

Определяем минимальный порог уверенности (confidence_threshold = 70).

Отбросываем все наблюдения внутри временного окна, у которых коэффициент уверенности ниже этого порога. Это поможет отсеять ненадежные или ошибочные распознавания.

3. Агрегирование "голосов" по цветам:

Для каждого уникального цвета (красный, желтый, зеленый, не определено и др.), оставшегося после фильтрации в окне просуммируем коэффициенты уверенности для всех наблюдений этого цвета. 

4. Определение доминирующего цвета:

* Приоритет определенных цветов: Если в color_scores присутствуют как 'не определено', так и другие цвета (красный, желтый, зеленый), то игнорируем 'не определено' при выборе победителя. Считайте, что если хоть один сенсор уверенно определил цвет, то это лучше, чем отсутствие определения.
Выберите цвет, который набрал наибольшую суммарную уверенность (наибольший "счет").

* Случай отсутствия данных: Если после всех фильтраций в окне не осталось ни одного наблюдения, или остались только наблюдения 'не определено' с низкой уверенностью, то результатом также будет 'Не определено' или 'Нет данных'.

---

**Моменты которые можно доработать в будущем:**
1. На данный момент нет обработки одновременно горящих сигналов светофора (например красного и желтого в основной доп. секции) 
2. Нет точной обработки мигающих сигналов светофора (status 9) в связи с отсутствием данных 

---




# Входные данные
 См. в файле SampleData\classified_tls.csv

# Выходные данные
Пример вывода в формате csv (--print_csv)
```bush
Time,Main,Left,Right
1720612826.0,2,0,0
1720612826.5,2,0,2
1720612827.0,2,0,2
1720612827.5,2,0,2
```

Пример стандартного вывода (--print_human)
```bush
Average sequence:
Time          | Main  | Left | Right
------------------------------------------
1720612826.0 |        2 |     0 |     0
1720612826.5 |        2 |     0 |     2
1720612827.0 |        2 |     0 |     2
1720612827.5 |        2 |     0 |     2
```
